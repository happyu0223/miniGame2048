<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹¼äººæ€ - å…¨æ–°ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.544.0/dist/umd/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&family=Ma+Shan+Zheng&display=swap');

        :root {
            --primary-dark: #1a1a1a;
            --primary: #4a4a4a;
            --primary-light: #6a6a6a;
            --secondary: #8b4513;
            --accent: #cc0000;
            --background: #0a0a0a;
            --text-light: #d0d0d0;
            --text-gold: #cc0000;
            --shadow-dark: rgba(0, 0, 0, 0.8);
            --shadow-accent: rgba(204, 0, 0, 0.3);
        }

        body {
            background-color: var(--background);
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: var(--text-light);
            font-family: 'Noto Sans SC', sans-serif;
            overflow-x: hidden;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            min-height: 100vh;
            border: 1px solid rgba(184, 134, 11, 0.2);
        }

        .title-font {
            font-family: 'Ma Shan Zheng', cursive;
            font-weight: normal;
            text-shadow: 2px 2px 4px var(--shadow-dark), 0 0 20px var(--shadow-accent);
            letter-spacing: 2px;
        }

        .dialogue-font {
            font-family: 'Noto Sans SC', sans-serif;
            font-weight: 500;
        }

        .role-werewolf { color: #ff4444; text-shadow: 0 0 10px #ff4444; }
        .role-seer { color: #44ffff; text-shadow: 0 0 10px #44ffff; }
        .role-witch { color: #ff44ff; text-shadow: 0 0 10px #ff44ff; }
        .role-hunter { color: #ffa500; text-shadow: 0 0 10px #ffa500; }
        .role-idiot { color: #ffff44; text-shadow: 0 0 10px #ffff44; }
        .role-villager { color: #44ff44; text-shadow: 0 0 10px #44ff44; }

        .player-avatar {
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .player-avatar:hover:not(.dead) {
            transform: translateY(-10px) scale(1.1);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.5);
        }

        .player-avatar.dead {
            filter: grayscale(100%) sepia(50%);
            opacity: 0.5;
        }

        .avatar-frame {
            border: 3px solid var(--accent);
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 20px var(--accent);
        }

        .avatar-frame.dead {
            border-color: #666;
            box-shadow: none;
        }

        .vote-count {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 3px solid white;
            z-index: 9999; /* è®¾ç½®ä¸ºæœ€é«˜å±‚çº§ */
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
            font-size: 16px;
            pointer-events: none; /* é¿å…é®æŒ¡ç‚¹å‡» */
        }

        .vote-count-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
            z-index: 5;
            font-size: 1rem;
        }

        .avatar-frame {
            position: relative;
            z-index: 1;
        }

        .timer-container {
            width: 100%;
            height: 8px;
            background-color: #333;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--secondary));
            transition: width 1s linear;
            box-shadow: 0 0 10px var(--accent);
        }

        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--accent);
            animation: fadeIn 0.5s ease;
        }

        /* å…¬å±åŒºåŸŸé™åˆ¶é«˜åº¦å¹¶å¯ç”¨æ»šè½®æ»šåŠ¨ */
        #chat-area {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 8px;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        #chat-area::-webkit-scrollbar {
            width: 8px;
        }

        #chat-area::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        #chat-area::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        #chat-area::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }

        .chat-message.system {
            background: rgba(218, 165, 32, 0.2);
            border-left-color: var(--accent);
            text-align: center;
            font-weight: bold;
        }

        .chat-message.private {
            background: rgba(128, 128, 128, 0.2);
            font-style: italic;
            border-left-color: #888;
        }

        .action-button {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: linear-gradient(145deg, var(--primary-dark), var(--primary));
            border: 2px solid var(--accent);
            box-shadow: 
                0 4px 8px var(--shadow-dark),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-shadow: 1px 1px 2px var(--shadow-dark);
        }

        .action-button.selected {
            background: linear-gradient(145deg, #2a0a0a, #4a1a1a);
            border-color: #cc0000;
            transform: translateY(2px);
            box-shadow: 
                0 2px 4px var(--shadow-dark),
                inset 0 1px 0 rgba(0, 0, 0, 0.3),
                0 0 20px rgba(204, 0, 0, 0.3);
        }

        .action-button.selected::after {
            content: 'âœ•';
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            color: #cc0000;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(204, 0, 0, 0.8);
        }

        .action-button.claw-effect::before {
            content: 'ğŸ©¸';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            color: #cc0000;
            opacity: 0;
            animation: clawMark 0.6s ease-out;
            pointer-events: none;
            z-index: 10;
        }

        .action-button:hover {
            background: linear-gradient(145deg, var(--primary), var(--primary-light));
            transform: translateY(-2px);
            box-shadow: 
                0 6px 12px var(--shadow-dark),
                0 0 20px var(--shadow-accent),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .action-button:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 4px var(--shadow-dark),
                inset 0 1px 0 rgba(0, 0, 0, 0.2);
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.3), transparent);
            transition: left 0.6s;
        }

        .action-button:hover::before {
            left: 100%;
        }

        .phase-indicator {
            animation: pulse 2s infinite;
            text-shadow: 0 0 20px var(--text-gold);
        }

        .chat-area {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(184, 134, 11, 0.3);
            backdrop-filter: blur(10px);
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(184, 134, 11, 0.3);
            backdrop-filter: blur(10px);
        }

        .action-area {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(184, 134, 11, 0.4);
            backdrop-filter: blur(10px);
        }

        .timer-bar {
            background: linear-gradient(90deg, var(--accent), var(--secondary));
            box-shadow: 0 0 15px var(--shadow-accent);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% { 
                text-shadow: 0 0 20px #cc0000;
            }
            50% { 
                text-shadow: 0 0 30px #cc0000, 0 0 40px rgba(204, 0, 0, 0.5);
            }
        }

        @keyframes clawMark {
            0% { 
                opacity: 0; 
                transform: scale(0.5) rotate(-10deg);
            }
            50% { 
                opacity: 1; 
                transform: scale(1) rotate(0deg);
            }
            100% { 
                opacity: 0; 
                transform: scale(1.2) rotate(10deg);
            }
        }

        .fog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(212, 175, 55, 0.03)" fill-opacity="1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,128C672,128,768,160,864,165.3C960,171,1056,149,1152,138.7C1248,128,1344,128,1392,128L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
            animation: fogMove 60s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes fogMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(-1440px); }
        }

        /* ç»ç’ƒæ€æ•ˆæœ */
        .glass-morphism {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(218, 165, 32, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
    </style>
</head>
<body>
    <div class="fog"></div>

    <div class="game-container min-h-screen flex flex-col items-center justify-center p-4">
        <!-- Menu Screen -->
        <div id="menu-screen" class="w-full max-w-4xl glass-morphism rounded-lg p-8 border-4 border-[var(--text-gold)] shadow-[0_0_30px_rgba(204,0,0,0.5)] relative">
            <button id="changelog-btn" class="absolute top-4 right-4 px-4 py-2 bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-[var(--text-light)] rounded-lg action-button text-sm border-2 border-[#cc0000] overflow-visible z-10">æ›´æ–°æ—¥å¿—</button>
            <div id="developer-mode-toggle" class="absolute top-16 right-4 px-4 py-2 bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-[var(--text-light)] rounded-lg action-button text-sm border-2 border-[#cc0000] overflow-visible z-10 cursor-pointer">
                <span>å¼€å‘è€…æ¨¡å¼</span>
            </div>
            <h1 class="text-6xl md:text-8xl font-bold text-center title-font text-[var(--text-gold)] mb-2 animate-[glow_3s_ease-in-out_infinite,float_6s_ease-in-out_infinite]">ç‹¼äººæ€</h1>
            <h2 class="text-2xl md:text-4xl font-bold text-center title-font text-[var(--text-gold)] mb-8 animate-[glow_3s_ease-in-out_infinite,float_6s_ease-in-out_infinite_0.5s]">Werewolf Game</h2>
            <div class="flex flex-col items-center space-y-8">
                <div class="text-center">
                    <p class="text-2xl mb-6 title-font text-[var(--text-gold)] animate-[glow_3s_ease-in-out_infinite]">é€‰æ‹©æ¸¸æˆäººæ•°</p>
                    <div id="player-count-options" class="flex flex-col items-center space-y-4">
                        <div class="text-center">
                            <button data-count="6" class="px-8 py-4 bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-[var(--text-light)] rounded-lg action-button text-xl border-2 border-[#cc0000]">
                                6äººå±€
                            </button>
                            <div class="mt-2 text-[var(--text-light)] text-sm">
                                ğŸºÃ—2 ğŸ”®Ã—1 ğŸŒ¿Ã—1 ğŸ§‘â€ğŸŒ¾Ã—2
                            </div>
                        </div>
                        <div class="text-center">
                            <button data-count="9" class="px-8 py-4 bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-[var(--text-light)] rounded-lg action-button text-xl border-2 border-[#cc0000]">
                                9äººå±€
                            </button>
                            <div class="mt-2 text-[var(--text-light)] text-sm">
                                ğŸºÃ—3 ğŸ”®Ã—1 ğŸŒ¿Ã—1 ğŸ”«Ã—1 ğŸ§‘â€ğŸŒ¾Ã—3
                            </div>
                        </div>
                        <div class="text-center">
                            <button data-count="12" class="px-8 py-4 bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-[var(--text-light)] rounded-lg action-button text-xl border-2 border-[#cc0000]">
                                12äººå±€
                            </button>
                            <div class="mt-2 text-[var(--text-light)] text-sm">
                                ğŸºÃ—4 ğŸ”®Ã—1 ğŸŒ¿Ã—1 ğŸ”«Ã—1 ğŸ˜Ã—1 ğŸ§‘â€ğŸŒ¾Ã—4
                            </div>
                        </div>
                    </div>
                </div>
                <div class="w-full flex justify-center space-x-6">
                    <button id="start-game-btn" class="px-10 py-5 bg-[var(--secondary)] text-white font-bold rounded-lg action-button text-2xl border-2 border-[#cc0000] disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        å¼€å§‹æ¸¸æˆ
                    </button>
                    <button id="rules-btn" class="px-10 py-5 bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-[var(--text-light)] rounded-lg action-button text-2xl border-2 border-[#cc0000]">
                        è§„åˆ™ä»‹ç»
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="w-full max-w-6xl hidden">
            <!-- Time Bar -->
            <div id="time-bar" class="w-full text-center py-4 glass-morphism rounded-lg mb-6 border-2 border-[var(--accent)]">
                <p class="text-2xl font-bold">ç¬¬ <span id="day-counter">1</span> å¤© Â· <span id="day-night">å¤œæ™š</span> <span id="phase-indicator" class="phase-indicator"></span></p>
                <div class="timer-container">
                    <div id="timer-bar" class="timer-bar w-full"></div>
                </div>
            </div>

            <!-- Player Avatars -->
            <div id="status-bar" class="w-full flex justify-center flex-wrap gap-6 mb-8">
                <!-- Player avatars will be injected here -->
            </div>

            <!-- Main Game Area -->
            <div id="main-area" class="w-full flex flex-col lg:flex-row gap-6">
                <!-- Chat Area -->
                <div id="chat-area" class="flex-1 h-[500px] glass-morphism rounded-lg p-6 overflow-y-auto border-2 border-[var(--accent)]">
                    <!-- Chat messages will be injected here -->
                </div>

                <!-- Action Area -->
                <div id="action-area" class="w-full lg:w-1/3 glass-morphism rounded-lg p-6 border-2 border-[var(--accent)]">
                    <!-- Action buttons will be injected here -->
                </div>
            </div>
        </div>

        <!-- Rules Modal -->
        <div id="rules-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="glass-morphism rounded-lg p-8 max-w-3xl w-full max-h-[80vh] overflow-y-auto border-4 border-[var(--accent)]">
                <h2 class="text-3xl font-bold text-[var(--text-gold)] mb-6 title-font">æ¸¸æˆè§„åˆ™</h2>
                <div id="rules-content" class="dialogue-font text-lg space-y-4">
                    <!-- Rules content will be injected here -->
                </div>
                <button id="close-rules-btn" class="mt-8 px-8 py-3 bg-[var(--secondary)] rounded-lg action-button text-xl border-2 border-[var(--accent)]">å…³é—­</button>
            </div>
        </div>
        
        <!-- Changelog Modal -->
        <div id="changelog-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="glass-morphism rounded-lg p-8 max-w-3xl w-full max-h-[80vh] overflow-y-auto border-4 border-[var(--accent)]">
                <h2 class="text-3xl font-bold text-[var(--text-gold)] mb-6 title-font">æ›´æ–°æ—¥å¿—</h2>
                <div id="changelog-content" class="dialogue-font text-lg space-y-4">
                    <!-- Changelog content will be injected here -->
                </div>
                <button id="close-changelog-btn" class="mt-8 px-8 py-3 bg-[var(--secondary)] rounded-lg action-button text-xl border-2 border-[var(--accent)]">å…³é—­</button>
            </div>
        </div>
        
        <!-- Game Over Modal -->
        <div id="game-over-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="glass-morphism rounded-lg p-8 max-w-3xl w-full max-h-[80vh] overflow-y-auto border-4 border-[var(--accent)]">
                <h2 class="text-4xl font-bold text-[var(--text-gold)] mb-6 title-font">æ¸¸æˆç»“æŸ</h2>
                <p id="game-over-message" class="text-3xl mb-8 dialogue-font text-center"></p>
                <div id="stats-container" class="mb-8 dialogue-font">
                    <!-- Stats will be injected here -->
                </div>
                <button id="game-statistics-btn" class="w-full py-4 mb-4 bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-[var(--text-light)] rounded-lg action-button text-2xl border-2 border-[var(--accent)]">æœ¬å±€ç»Ÿè®¡</button>
                <button id="back-to-menu-btn" class="w-full py-4 bg-[var(--secondary)] rounded-lg action-button text-2xl border-2 border-[var(--accent)]">è¿”å›ä¸»èœå•</button>
            </div>
        </div>

        <!-- Game Statistics Modal -->
        <div id="game-statistics-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="glass-morphism rounded-lg p-8 max-w-4xl w-full max-h-[80vh] overflow-y-auto border-4 border-[var(--accent)]">
                <h2 class="text-4xl font-bold text-[var(--text-gold)] mb-6 title-font">æœ¬å±€ç»Ÿè®¡</h2>
                <div id="statistics-content" class="dialogue-font text-lg space-y-6">
                    <!-- Statistics content will be injected here -->
                </div>
                <button id="close-statistics-btn" class="mt-8 w-full py-4 bg-[var(--secondary)] rounded-lg action-button text-2xl border-2 border-[var(--accent)]">å…³é—­</button>
            </div>
        </div>

        <!-- Voting Modal -->
        <div id="voting-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
            <div class="glass-morphism rounded-lg p-6 max-w-3xl w-full max-h-[80vh] border-4 border-[var(--accent)] flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold title-font text-[var(--text-gold)]">æŠ•ç¥¨é˜¶æ®µ</h3>
                    <button id="close-voting-btn" class="px-4 py-2 bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-[var(--text-light)] rounded-lg action-button border-2 border-[var(--accent)]">å…³é—­</button>
                </div>
                <p class="text-xl mb-6 dialogue-font">è¯·é€‰æ‹©ä½ è¦æŠ•ç¥¨çš„ç©å®¶ï¼š</p>
                <div id="voting-options" class="flex flex-wrap justify-center gap-6 mb-6">
                    <!-- Voting options will be injected here -->
                </div>
                <div class="mt-auto">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-lg dialogue-font">å‰©ä½™æ—¶é—´ï¼š<span id="voting-timer">30</span>ç§’</p>
                        <p class="text-lg dialogue-font">å½“å‰ç¥¨æ•°ï¼š<span id="current-votes">0</span>/<span id="total-players">0</span></p>
                    </div>
                    <button id="submit-vote-btn" class="w-full py-4 bg-[var(--secondary)] text-white font-bold rounded-lg action-button text-xl border-2 border-[var(--accent)] disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        æäº¤æŠ•ç¥¨
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Game state
            const gameState = {
                playerCount: null,
                players: [],
                currentPlayerIndex: 0,
                day: 1,
                isDay: false,
                phase: 'night',
                phaseTimer: null,
                phaseDuration: 60, // seconds
                votes: {},
                gameStarted: false,
                developerMode: false,
                statistics: {
                    totalDays: 0,
                    votesCast: 0,
                    abilitiesUsed: 0,
                    playersKilled: 0,
                    wolvesKilled: 0,
                    villagersKilled: 0
                }
            };

            // DOM Elements
            const menuScreen = document.getElementById('menu-screen');
            const gameScreen = document.getElementById('game-screen');
            const startGameBtn = document.getElementById('start-game-btn');
            const rulesBtn = document.getElementById('rules-btn');
            const rulesModal = document.getElementById('rules-modal');
            const closeRulesBtn = document.getElementById('close-rules-btn');
            const changelogBtn = document.getElementById('changelog-btn');
            const changelogModal = document.getElementById('changelog-modal');
            const closeChangelogBtn = document.getElementById('close-changelog-btn');
            const gameOverModal = document.getElementById('game-over-modal');
            const gameOverMessage = document.getElementById('game-over-message');
            const statsContainer = document.getElementById('stats-container');
            const gameStatisticsBtn = document.getElementById('game-statistics-btn');
            const backToMenuBtn = document.getElementById('back-to-menu-btn');
            const gameStatisticsModal = document.getElementById('game-statistics-modal');
            const statisticsContent = document.getElementById('statistics-content');
            const closeStatisticsBtn = document.getElementById('close-statistics-btn');
            const votingModal = document.getElementById('voting-modal');
            const closeVotingBtn = document.getElementById('close-voting-btn');
            const votingOptions = document.getElementById('voting-options');
            const votingTimer = document.getElementById('voting-timer');
            const currentVotes = document.getElementById('current-votes');
            const totalPlayers = document.getElementById('total-players');
            const submitVoteBtn = document.getElementById('submit-vote-btn');
            const developerModeToggle = document.getElementById('developer-mode-toggle');
            const playerCountOptions = document.getElementById('player-count-options');
            const statusBar = document.getElementById('status-bar');
            const chatArea = document.getElementById('chat-area');
            const actionArea = document.getElementById('action-area');
            const dayCounter = document.getElementById('day-counter');
            const dayNight = document.getElementById('day-night');
            const phaseIndicator = document.getElementById('phase-indicator');
            const timerBar = document.getElementById('timer-bar');

            // Player roles
            const roles = {
                werewolf: { name: 'ç‹¼äºº', icon: 'ğŸº', color: 'role-werewolf', description: 'æ¯æ™šå¯ä»¥æ€æ­»ä¸€åç©å®¶' },
                seer: { name: 'é¢„è¨€å®¶', icon: 'ğŸ”®', color: 'role-seer', description: 'æ¯æ™šå¯ä»¥æŸ¥éªŒä¸€åç©å®¶çš„èº«ä»½' },
                witch: { name: 'å¥³å·«', icon: 'ğŸŒ¿', color: 'role-witch', description: 'æ‹¥æœ‰ä¸€ç“¶è§£è¯å’Œä¸€ç“¶æ¯’è¯' },
                hunter: { name: 'çŒäºº', icon: 'ğŸ”«', color: 'role-hunter', description: 'æ­»äº¡æ—¶å¯ä»¥å¼€æªå¸¦èµ°ä¸€åç©å®¶' },
                idiot: { name: 'ç™½ç—´', icon: 'ğŸ˜', color: 'role-idiot', description: 'è¢«æ”¾é€æ—¶ä¸ä¼šç«‹å³æ­»äº¡' },
                villager: { name: 'æ‘æ°‘', icon: 'ğŸ§‘â€ğŸŒ¾', color: 'role-villager', description: 'æ²¡æœ‰ç‰¹æ®Šèƒ½åŠ›' }
            };

            // Game configuration based on player count
            const gameConfig = {
                6: {
                    roles: [
                        { role: 'werewolf', count: 2 },
                        { role: 'seer', count: 1 },
                        { role: 'witch', count: 1 },
                        { role: 'villager', count: 2 }
                    ],
                    phaseDuration: {
                        night: 60,
                        discussion: 120,
                        voting: 60
                    }
                },
                9: {
                    roles: [
                        { role: 'werewolf', count: 3 },
                        { role: 'seer', count: 1 },
                        { role: 'witch', count: 1 },
                        { role: 'hunter', count: 1 },
                        { role: 'villager', count: 3 }
                    ],
                    phaseDuration: {
                        night: 90,
                        discussion: 180,
                        voting: 90
                    }
                },
                12: {
                    roles: [
                        { role: 'werewolf', count: 4 },
                        { role: 'seer', count: 1 },
                        { role: 'witch', count: 1 },
                        { role: 'hunter', count: 1 },
                        { role: 'idiot', count: 1 },
                        { role: 'villager', count: 4 }
                    ],
                    phaseDuration: {
                        night: 120,
                        discussion: 240,
                        voting: 120
                    }
                }
            };

            // Initialize the game
            function init() {
                // Set up event listeners
                setupEventListeners();
                
                // Load rules and changelog
                loadRules();
                loadChangelog();
                
                // Add glass morphism class to elements
                document.querySelectorAll('.game-container > div').forEach(el => {
                    if (!el.classList.contains('glass-morphism')) {
                        el.classList.add('glass-morphism');
                    }
                });
            }

            // Set up event listeners
            function setupEventListeners() {
                // Player count selection
                playerCountOptions.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        // Remove selected class from all buttons
                        playerCountOptions.querySelectorAll('button').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                        
                        // Add selected class to clicked button
                        e.target.classList.add('selected');
                        
                        // Set player count
                        gameState.playerCount = parseInt(e.target.dataset.count);
                        
                        // Enable start game button
                        startGameBtn.disabled = false;
                    }
                });

                // Start game button
                startGameBtn.addEventListener('click', startGame);

                // Rules button
                rulesBtn.addEventListener('click', () => {
                    rulesModal.classList.remove('hidden');
                });

                // Close rules button
                closeRulesBtn.addEventListener('click', () => {
                    rulesModal.classList.add('hidden');
                });

                // Changelog button
                changelogBtn.addEventListener('click', () => {
                    changelogModal.classList.remove('hidden');
                });

                // Close changelog button
                closeChangelogBtn.addEventListener('click', () => {
                    changelogModal.classList.add('hidden');
                });

                // Game statistics button
                gameStatisticsBtn.addEventListener('click', () => {
                    gameOverModal.classList.add('hidden');
                    gameStatisticsModal.classList.remove('hidden');
                    showGameStatistics();
                });

                // Back to menu button
                backToMenuBtn.addEventListener('click', resetGame);

                // Close statistics button
                closeStatisticsBtn.addEventListener('click', () => {
                    gameStatisticsModal.classList.add('hidden');
                });

                // Close voting button
                closeVotingBtn.addEventListener('click', () => {
                    votingModal.classList.add('hidden');
                });

                // Submit vote button
                submitVoteBtn.addEventListener('click', submitVote);

                // Developer mode toggle
                developerModeToggle.addEventListener('click', () => {
                    gameState.developerMode = !gameState.developerMode;
                    developerModeToggle.querySelector('span').textContent = 
                        gameState.developerMode ? 'å¼€å‘è€…æ¨¡å¼ (å¼€)' : 'å¼€å‘è€…æ¨¡å¼';
                    developerModeToggle.classList.toggle('selected', gameState.developerMode);
                });

                // Close modals when clicking outside
                window.addEventListener('click', (e) => {
                    if (e.target === rulesModal) rulesModal.classList.add('hidden');
                    if (e.target === changelogModal) changelogModal.classList.add('hidden');
                    if (e.target === gameOverModal) gameOverModal.classList.add('hidden');
                    if (e.target === gameStatisticsModal) gameStatisticsModal.classList.add('hidden');
                    if (e.target === votingModal) votingModal.classList.add('hidden');
                });
            }

            // Load rules content
            function loadRules() {
                const rulesContent = document.getElementById('rules-content');
                rulesContent.innerHTML = `
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-2xl font-bold text-[var(--text-gold)] mb-2">æ¸¸æˆç›®æ ‡</h3>
                            <p>ç‹¼äººé˜µè¥ï¼šæ€æ­»æ‰€æœ‰æ‘æ°‘æˆ–ç¥èŒäººå‘˜ã€‚</p>
                            <p>å¥½äººé˜µè¥ï¼šæ‰¾å‡ºå¹¶æ”¾é€æ‰€æœ‰ç‹¼äººã€‚</p>
                        </div>
                        
                        <div>
                            <h3 class="text-2xl font-bold text-[var(--text-gold)] mb-2">è§’è‰²ä»‹ç»</h3>
                            <div class="space-y-2">
                                <p><span class="role-werewolf">ğŸº ç‹¼äºº</span>ï¼šæ¯æ™šå¯ä»¥æ€æ­»ä¸€åç©å®¶ã€‚</p>
                                <p><span class="role-seer">ğŸ”® é¢„è¨€å®¶</span>ï¼šæ¯æ™šå¯ä»¥æŸ¥éªŒä¸€åç©å®¶çš„èº«ä»½ã€‚</p>
                                <p><span class="role-witch">ğŸŒ¿ å¥³å·«</span>ï¼šæ‹¥æœ‰ä¸€ç“¶è§£è¯å’Œä¸€ç“¶æ¯’è¯ï¼Œè§£è¯å¯ä»¥æ•‘èµ·è¢«ç‹¼äººæ€æ­»çš„ç©å®¶ï¼Œæ¯’è¯å¯ä»¥æ¯’æ­»ä»»æ„ä¸€åç©å®¶ã€‚</p>
                                <p><span class="role-hunter">ğŸ”« çŒäºº</span>ï¼šå½“çŒäººè¢«ç‹¼äººæ€æ­»æˆ–è¢«æ‘æ°‘æ”¾é€æ—¶ï¼Œå¯ä»¥å¼€æªå¸¦èµ°ä¸€åç©å®¶ã€‚</p>
                                <p><span class="role-idiot">ğŸ˜ ç™½ç—´</span>ï¼šå½“ç™½ç—´è¢«æ‘æ°‘æ”¾é€æ—¶ï¼Œä¸ä¼šç«‹å³æ­»äº¡ï¼Œè€Œæ˜¯ç¿»å¼€èº«ä»½ç‰Œï¼Œç»§ç»­ç•™åœ¨æ¸¸æˆä¸­ï¼Œä½†å¤±å»æŠ•ç¥¨æƒã€‚</p>
                                <p><span class="role-villager">ğŸ§‘â€ğŸŒ¾ æ‘æ°‘</span>ï¼šæ²¡æœ‰ç‰¹æ®Šèƒ½åŠ›ï¼Œåªèƒ½é€šè¿‡ç™½å¤©çš„æŠ•ç¥¨æ”¾é€ç‹¼äººã€‚</p>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-2xl font-bold text-[var(--text-gold)] mb-2">æ¸¸æˆæµç¨‹</h3>
                            <ol class="list-decimal list-inside space-y-2">
                                <li>æ¸¸æˆå¼€å§‹æ—¶ï¼Œæ¯ä½ç©å®¶éšæœºè·å¾—ä¸€ä¸ªèº«ä»½ã€‚</li>
                                <li>å¤œæ™šé˜¶æ®µï¼Œç‹¼äººã€é¢„è¨€å®¶ã€å¥³å·«ç­‰è§’è‰²ä¾æ¬¡è¡ŒåŠ¨ã€‚</li>
                                <li>ç™½å¤©é˜¶æ®µï¼Œæ‰€æœ‰ç©å®¶è¿›è¡Œè®¨è®ºï¼Œç„¶åæŠ•ç¥¨æ”¾é€ä¸€åç©å®¶ã€‚</li>
                                <li>é‡å¤å¤œæ™šå’Œç™½å¤©é˜¶æ®µï¼Œç›´åˆ°æŸä¸€é˜µè¥è¾¾æˆèƒœåˆ©æ¡ä»¶ã€‚</li>
                            </ol>
                        </div>
                        
                        <div>
                            <h3 class="text-2xl font-bold text-[var(--text-gold)] mb-2">èƒœåˆ©æ¡ä»¶</h3>
                            <p>ç‹¼äººé˜µè¥èƒœåˆ©ï¼šå½“ç‹¼äººæ•°é‡å¤§äºæˆ–ç­‰äºå¥½äººæ•°é‡æ—¶ã€‚</p>
                            <p>å¥½äººé˜µè¥èƒœåˆ©ï¼šå½“æ‰€æœ‰ç‹¼äººéƒ½è¢«æ”¾é€æ—¶ã€‚</p>
                        </div>
                    </div>
                `;
            }

            // Load changelog content
            function loadChangelog() {
                const changelogContent = document.getElementById('changelog-content');
                changelogContent.innerHTML = `
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-2xl font-bold text-[var(--text-gold)] mb-2">v1.0.0 (2024-01-07)</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li>å…¨æ–°ç‹¼äººæ€æ¸¸æˆä¸Šçº¿ï¼</li>
                                <li>æ”¯æŒ6äººã€9äººã€12äººä¸‰ç§æ¸¸æˆæ¨¡å¼ã€‚</li>
                                <li>åŒ…å«ç‹¼äººã€é¢„è¨€å®¶ã€å¥³å·«ã€çŒäººã€ç™½ç—´ã€æ‘æ°‘å…­ç§è§’è‰²ã€‚</li>
                                <li>å®ç°äº†å®Œæ•´çš„æ¸¸æˆæµç¨‹ï¼šå¤œæ™šè¡ŒåŠ¨ã€ç™½å¤©è®¨è®ºã€æŠ•ç¥¨æ”¾é€ã€‚</li>
                                <li>æ·»åŠ äº†ç²¾ç¾çš„æ¸¸æˆç•Œé¢å’ŒåŠ¨ç”»æ•ˆæœã€‚</li>
                                <li>æ”¯æŒå¼€å‘è€…æ¨¡å¼ï¼Œå¯ä»¥æŸ¥çœ‹æ›´å¤šæ¸¸æˆä¿¡æ¯ã€‚</li>
                            </ul>
                        </div>
                    </div>
                `;
            }

            // Start the game
            function startGame() {
                // Hide menu screen and show game screen
                menuScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                
                // Initialize game state
                gameState.players = [];
                gameState.currentPlayerIndex = 0;
                gameState.day = 1;
                gameState.isDay = false;
                gameState.phase = 'night';
                gameState.votes = {};
                gameState.gameStarted = true;
                gameState.statistics = {
                    totalDays: 0,
                    votesCast: 0,
                    abilitiesUsed: 0,
                    playersKilled: 0,
                    wolvesKilled: 0,
                    villagersKilled: 0
                };
                
                // Create players
                createPlayers();
                
                // Update UI
                updateGameUI();
                
                // Start game loop
                startGameLoop();
                
                // Add system message
                addChatMessage('ç³»ç»Ÿ', 'æ¸¸æˆå¼€å§‹ï¼è¯·æŸ¥çœ‹ä½ çš„èº«ä»½ã€‚', 'system');
            }

            // Create players based on selected player count
            function createPlayers() {
                const config = gameConfig[gameState.playerCount];
                let rolePool = [];
                
                // Create role pool based on configuration
                config.roles.forEach(roleConfig => {
                    for (let i = 0; i < roleConfig.count; i++) {
                        rolePool.push(roleConfig.role);
                    }
                });
                
                // Shuffle role pool
                rolePool = shuffleArray(rolePool);
                
                // Create players
                for (let i = 0; i < gameState.playerCount; i++) {
                    const role = rolePool[i];
                    gameState.players.push({
                        id: i,
                        name: `ç©å®¶${i + 1}`,
                        role: role,
                        isAlive: true,
                        hasVoted: false,
                        votesReceived: 0,
                        abilities: initPlayerAbilities(role),
                        chatColor: roles[role].color
                    });
                }
                
                // Set current player (for testing purposes, set to first player)
                gameState.currentPlayerIndex = 0;
            }

            // Initialize player abilities based on role
            function initPlayerAbilities(role) {
                switch (role) {
                    case 'witch':
                        return {
                            hasPotion: true,
                            hasPoison: true
                        };
                    case 'seer':
                        return {
                            hasChecked: false
                        };
                    case 'hunter':
                        return {
                            hasShot: true
                        };
                    default:
                        return {};
                }
            }

            // Update game UI
            function updateGameUI() {
                // Update day counter and day/night indicator
                dayCounter.textContent = gameState.day;
                dayNight.textContent = gameState.isDay ? 'ç™½å¤©' : 'å¤œæ™š';
                
                // Update phase indicator
                updatePhaseIndicator();
                
                // Update player avatars
                updatePlayerAvatars();
                
                // Update action area based on current phase and player role
                updateActionArea();
                
                // Update timer
                updateTimer();
            }

            // Update phase indicator
            function updatePhaseIndicator() {
                let phaseText = '';
                
                if (!gameState.isDay) {
                    phaseText = 'å¤œæ™šè¡ŒåŠ¨ä¸­';
                } else {
                    if (gameState.phase === 'discussion') {
                        phaseText = 'è®¨è®ºé˜¶æ®µ';
                    } else if (gameState.phase === 'voting') {
                        phaseText = 'æŠ•ç¥¨é˜¶æ®µ';
                    }
                }
                
                phaseIndicator.textContent = phaseText;
            }

            // Update player avatars
            function updatePlayerAvatars() {
                statusBar.innerHTML = '';
                
                gameState.players.forEach(player => {
                    const avatarContainer = document.createElement('div');
                    avatarContainer.className = `player-avatar ${player.isAlive ? '' : 'dead'} flex flex-col items-center`;
                    avatarContainer.dataset.playerId = player.id;
                    
                    const avatarFrame = document.createElement('div');
                    avatarFrame.className = `avatar-frame ${player.isAlive ? '' : 'dead'} w-20 h-20 flex items-center justify-center text-4xl mb-2`;
                    
                    // Show role icon if player is dead or in developer mode
                    const showRole = !player.isAlive || gameState.developerMode || player.id === gameState.currentPlayerIndex;
                    avatarFrame.innerHTML = showRole ? roles[player.role].icon : 'â“';
                    
                    const playerName = document.createElement('div');
                    playerName.className = `text-center ${player.isAlive ? '' : 'line-through'}`;
                    playerName.textContent = player.name;
                    
                    // Add vote count if player has received votes
                    if (player.votesReceived > 0) {
                        const voteCount = document.createElement('div');
                        voteCount.className = 'vote-count';
                        voteCount.textContent = player.votesReceived;
                        avatarContainer.appendChild(voteCount);
                    }
                    
                    avatarContainer.appendChild(avatarFrame);
                    avatarContainer.appendChild(playerName);
                    
                    // Add click event for player interaction
                    if (player.isAlive) {
                        avatarContainer.addEventListener('click', () => handlePlayerInteraction(player));
                    }
                    
                    statusBar.appendChild(avatarContainer);
                });
            }

            // Update action area based on current phase and player role
            function updateActionArea() {
                actionArea.innerHTML = '';
                
                const currentPlayer = gameState.players[gameState.currentPlayerIndex];
                
                if (!gameState.isDay) {
                    // Night phase
                    if (currentPlayer.isAlive) {
                        switch (currentPlayer.role) {
                            case 'werewolf':
                                addNightAction('é€‰æ‹©è¦å‡»æ€çš„ç©å®¶', 'kill');
                                break;
                            case 'seer':
                                addNightAction('é€‰æ‹©è¦æŸ¥éªŒçš„ç©å®¶', 'check');
                                break;
                            case 'witch':
                                addWitchActions();
                                break;
                            default:
                                addPassAction();
                                break;
                        }
                    } else {
                        addPassAction();
                    }
                } else {
                    // Day phase
                    if (gameState.phase === 'discussion') {
                        addDiscussionActions();
                    } else if (gameState.phase === 'voting') {
                        addVotingActions();
                    }
                }
            }

            // Add night action button
            function addNightAction(text, actionType) {
                const actionTitle = document.createElement('h3');
                actionTitle.className = 'text-2xl font-bold text-[var(--text-gold)] mb-4 text-center';
                actionTitle.textContent = text;
                
                const actionButtonsContainer = document.createElement('div');
                actionButtonsContainer.className = 'flex flex-wrap justify-center gap-4';
                
                gameState.players.forEach(player => {
                    if (player.isAlive && player.id !== gameState.currentPlayerIndex) {
                        const actionButton = document.createElement('button');
                        actionButton.className = 'action-button px-4 py-2 rounded-lg';
                        actionButton.dataset.playerId = player.id;
                        actionButton.dataset.actionType = actionType;
                        
                        // Show role icon if in developer mode
                        const showRole = gameState.developerMode;
                        actionButton.innerHTML = `${showRole ? roles[player.role].icon : 'â“'} ${player.name}`;
                        
                        actionButton.addEventListener('click', () => handleNightAction(actionType, player.id));
                        actionButtonsContainer.appendChild(actionButton);
                    }
                });
                
                actionArea.appendChild(actionTitle);
                actionArea.appendChild(actionButtonsContainer);
            }

            // Add witch actions
            function addWitchActions() {
                const currentPlayer = gameState.players[gameState.currentPlayerIndex];
                const actionTitle = document.createElement('h3');
                actionTitle.className = 'text-2xl font-bold text-[var(--text-gold)] mb-4 text-center';
                actionTitle.textContent = 'å¥³å·«è¡ŒåŠ¨';
                
                const actionInfo = document.createElement('div');
                actionInfo.className = 'mb-6 text-center';
                actionInfo.innerHTML = `
                    <p class="mb-2">è§£è¯: ${currentPlayer.abilities.hasPotion ? 'âœ…' : 'âŒ'}</p>
                    <p>æ¯’è¯: ${currentPlayer.abilities.hasPoison ? 'âœ…' : 'âŒ'}</p>
                `;
                
                const actionButtonsContainer = document.createElement('div');
                actionButtonsContainer.className = 'flex flex-wrap justify-center gap-4';
                
                // Add pass button
                const passButton = document.createElement('button');
                passButton.className = 'action-button px-6 py-3 rounded-lg';
                passButton.textContent = 'è·³è¿‡';
                passButton.addEventListener('click', () => handleNightAction('pass', null));
                actionButtonsContainer.appendChild(passButton);
                
                // Add save button if witch has potion
                if (currentPlayer.abilities.hasPotion) {
                    const saveButton = document.createElement('button');
                    saveButton.className = 'action-button px-6 py-3 rounded-lg';
                    saveButton.textContent = 'ä½¿ç”¨è§£è¯';
                    saveButton.addEventListener('click', () => handleNightAction('save', null));
                    actionButtonsContainer.appendChild(saveButton);
                }
                
                // Add poison button if witch has poison
                if (currentPlayer.abilities.hasPoison) {
                    const poisonTitle = document.createElement('p');
                    poisonTitle.className = 'w-full text-center mt-4 mb-2';
                    poisonTitle.textContent = 'é€‰æ‹©è¦æ¯’æ€çš„ç©å®¶:';
                    actionButtonsContainer.appendChild(poisonTitle);
                    
                    gameState.players.forEach(player => {
                        if (player.isAlive && player.id !== gameState.currentPlayerIndex) {
                            const poisonButton = document.createElement('button');
                            poisonButton.className = 'action-button px-4 py-2 rounded-lg';
                            poisonButton.dataset.playerId = player.id;
                            poisonButton.dataset.actionType = 'poison';
                            
                            // Show role icon if in developer mode
                            const showRole = gameState.developerMode;
                            poisonButton.innerHTML = `${showRole ? roles[player.role].icon : 'â“'} ${player.name}`;
                            
                            poisonButton.addEventListener('click', () => handleNightAction('poison', player.id));
                            actionButtonsContainer.appendChild(poisonButton);
                        }
                    });
                }
                
                actionArea.appendChild(actionTitle);
                actionArea.appendChild(actionInfo);
                actionArea.appendChild(actionButtonsContainer);
            }

            // Add pass action
            function addPassAction() {
                const actionTitle = document.createElement('h3');
                actionTitle.className = 'text-2xl font-bold text-[var(--text-gold)] mb-4 text-center';
                actionTitle.textContent = 'ç­‰å¾…å…¶ä»–ç©å®¶è¡ŒåŠ¨...';
                
                const passButton = document.createElement('button');
                passButton.className = 'action-button px-6 py-3 rounded-lg w-full';
                passButton.textContent = 'è·³è¿‡';
                passButton.addEventListener('click', () => {
                    // In a real game, this would wait for all players, but for demo we just proceed
                    proceedToNextPhase();
                });
                
                actionArea.appendChild(actionTitle);
                actionArea.appendChild(passButton);
            }

            // Add discussion actions
            function addDiscussionActions() {
                const actionTitle = document.createElement('h3');
                actionTitle.className = 'text-2xl font-bold text-[var(--text-gold)] mb-4 text-center';
                actionTitle.textContent = 'è®¨è®ºé˜¶æ®µ';
                
                const discussionInfo = document.createElement('div');
                discussionInfo.className = 'mb-6 text-center';
                discussionInfo.textContent = 'è¯·åœ¨èŠå¤©åŒºåŸŸè¿›è¡Œè®¨è®ºã€‚';
                
                const chatInputContainer = document.createElement('div');
                chatInputContainer.className = 'flex gap-2';
                
                const chatInput = document.createElement('input');
                chatInput.type = 'text';
                chatInput.className = 'flex-1 px-4 py-2 rounded-lg bg-[var(--primary-dark)] text-[var(--text-light)] border border-[var(--accent)]';
                chatInput.placeholder = 'è¾“å…¥è®¨è®ºå†…å®¹...';
                
                const sendButton = document.createElement('button');
                sendButton.className = 'action-button px-4 py-2 rounded-lg';
                sendButton.textContent = 'å‘é€';
                sendButton.addEventListener('click', () => {
                    if (chatInput.value.trim()) {
                        sendChatMessage(chatInput.value.trim());
                        chatInput.value = '';
                    }
                });
                
                // Add Enter key support
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendButton.click();
                    }
                });
                
                chatInputContainer.appendChild(chatInput);
                chatInputContainer.appendChild(sendButton);
                
                actionArea.appendChild(actionTitle);
                actionArea.appendChild(discussionInfo);
                actionArea.appendChild(chatInputContainer);
            }

            // Add voting actions
            function addVotingActions() {
                const actionTitle = document.createElement('h3');
                actionTitle.className = 'text-2xl font-bold text-[var(--text-gold)] mb-4 text-center';
                actionTitle.textContent = 'æŠ•ç¥¨é˜¶æ®µ';
                
                const votingInfo = document.createElement('div');
                votingInfo.className = 'mb-6 text-center';
                votingInfo.textContent = 'è¯·é€‰æ‹©è¦æŠ•ç¥¨æ”¾é€çš„ç©å®¶ã€‚';
                
                const voteButton = document.createElement('button');
                voteButton.className = 'action-button px-6 py-3 rounded-lg w-full';
                voteButton.textContent = 'æ‰“å¼€æŠ•ç¥¨é¢æ¿';
                voteButton.addEventListener('click', openVotingPanel);
                
                actionArea.appendChild(actionTitle);
                actionArea.appendChild(votingInfo);
                actionArea.appendChild(voteButton);
            }

            // Update timer
            function updateTimer() {
                const config = gameConfig[gameState.playerCount];
                let duration = config.phaseDuration.night;
                
                if (gameState.isDay) {
                    duration = gameState.phase === 'discussion' 
                        ? config.phaseDuration.discussion 
                        : config.phaseDuration.voting;
                }
                
                gameState.phaseDuration = duration;
                gameState.remainingTime = duration;
                
                // Clear existing timer
                if (gameState.phaseTimer) {
                    clearInterval(gameState.phaseTimer);
                }
                
                // Start new timer
                gameState.phaseTimer = setInterval(() => {
                    gameState.remainingTime--;
                    updateTimerBar();
                    
                    if (gameState.remainingTime <= 0) {
                        clearInterval(gameState.phaseTimer);
                        proceedToNextPhase();
                    }
                }, 1000);
                
                updateTimerBar();
            }

            // Update timer bar
            function updateTimerBar() {
                const percentage = (gameState.remainingTime / gameState.phaseDuration) * 100;
                timerBar.style.width = `${percentage}%`;
            }

            // Handle player interaction
            function handlePlayerInteraction(player) {
                // This function can be expanded for more complex interactions
                console.log(`Player ${player.id} (${player.name}) clicked`);
            }

            // Handle night action
            function handleNightAction(actionType, targetPlayerId) {
                const currentPlayer = gameState.players[gameState.currentPlayerIndex];
                
                switch (actionType) {
                    case 'kill':
                        // Handle werewolf kill
                        addChatMessage('ç‹¼äºº', `é€‰æ‹©å‡»æ€ ${gameState.players[targetPlayerId].name}`, 'private');
                        gameState.statistics.abilitiesUsed++;
                        gameState.statistics.playersKilled++;
                        proceedToNextPhase();
                        break;
                        
                    case 'check':
                        // Handle seer check
                        const targetPlayer = gameState.players[targetPlayerId];
                        const isWolf = targetPlayer.role === 'werewolf';
                        addChatMessage('é¢„è¨€å®¶', `æŸ¥éªŒç»“æœï¼š${targetPlayer.name} ${isWolf ? 'æ˜¯ç‹¼äºº' : 'ä¸æ˜¯ç‹¼äºº'}`, 'private');
                        currentPlayer.abilities.hasChecked = true;
                        gameState.statistics.abilitiesUsed++;
                        proceedToNextPhase();
                        break;
                        
                    case 'save':
                        // Handle witch save
                        addChatMessage('å¥³å·«', 'ä½¿ç”¨äº†è§£è¯', 'private');
                        currentPlayer.abilities.hasPotion = false;
                        gameState.statistics.abilitiesUsed++;
                        proceedToNextPhase();
                        break;
                        
                    case 'poison':
                        // Handle witch poison
                        addChatMessage('å¥³å·«', `ä½¿ç”¨æ¯’è¯æ¯’æ€ ${gameState.players[targetPlayerId].name}`, 'private');
                        currentPlayer.abilities.hasPoison = false;
                        gameState.statistics.abilitiesUsed++;
                        gameState.statistics.playersKilled++;
                        
                        // Mark player to be killed by poison
                        gameState.players[targetPlayerId].markedByPoison = true;
                        
                        proceedToNextPhase();
                        break;
                        
                    case 'pass':
                        // Handle pass action
                        proceedToNextPhase();
                        break;
                }
            }

            // Proceed to next phase
            function proceedToNextPhase() {
                if (!gameState.isDay) {
                    // Night phase -> Day phase
                    resolveNightActions();
                    gameState.isDay = true;
                    gameState.phase = 'discussion';
                    gameState.day++;
                    gameState.statistics.totalDays++;
                    
                    // Check for game over after night actions
                    if (checkGameOver()) {
                        return;
                    }
                    
                    addChatMessage('ç³»ç»Ÿ', `ç¬¬ ${gameState.day} å¤©å¼€å§‹äº†ï¼`, 'system');
                } else {
                    if (gameState.phase === 'discussion') {
                        // Discussion phase -> Voting phase
                        gameState.phase = 'voting';
                        resetVotes();
                        addChatMessage('ç³»ç»Ÿ', 'è®¨è®ºæ—¶é—´ç»“æŸï¼Œå¼€å§‹æŠ•ç¥¨ï¼', 'system');
                    } else {
                        // Voting phase -> Night phase
                        resolveVoting();
                        gameState.isDay = false;
                        gameState.phase = 'night';
                        
                        // Check for game over after voting
                        if (checkGameOver()) {
                            return;
                        }
                        
                        addChatMessage('ç³»ç»Ÿ', 'å¤©é»‘è¯·é—­çœ¼', 'system');
                    }
                }
                
                updateGameUI();
            }

            // Resolve night actions
            function resolveNightActions() {
                // In a real game, this would handle all night actions
                // For demo purposes, we'll simulate some actions
                
                // Check for players marked by poison
                gameState.players.forEach(player => {
                    if (player.markedByPoison) {
                        player.isAlive = false;
                        addChatMessage('ç³»ç»Ÿ', `${player.name} è¢«å¥³å·«æ¯’æ­»äº†ï¼`, 'system');
                        
                        // Check if player is a wolf
                        if (player.role === 'werewolf') {
                            gameState.statistics.wolvesKilled++;
                        } else {
                            gameState.statistics.villagersKilled++;
                        }
                        
                        // Handle hunter ability
                        if (player.role === 'hunter' && player.abilities.hasShot) {
                            // In a real game, this would allow the hunter to choose a target
                            // For demo purposes, we'll randomly select a target
                            const alivePlayers = gameState.players.filter(p => p.isAlive && p.id !== player.id);
                            if (alivePlayers.length > 0) {
                                const targetIndex = Math.floor(Math.random() * alivePlayers.length);
                                const targetPlayer = alivePlayers[targetIndex];
                                
                                targetPlayer.isAlive = false;
                                addChatMessage('ç³»ç»Ÿ', `${player.name}ï¼ˆçŒäººï¼‰å¼€æªå¸¦èµ°äº† ${targetPlayer.name}ï¼`, 'system');
                                
                                // Check if target is a wolf
                                if (targetPlayer.role === 'werewolf') {
                                    gameState.statistics.wolvesKilled++;
                                } else {
                                    gameState.statistics.villagersKilled++;
                                }
                            }
                        }
                        
                        // Handle idiot ability
                        if (player.role === 'idiot') {
                            player.isAlive = true; // Idiot doesn't die immediately
                            addChatMessage('ç³»ç»Ÿ', `${player.name}ï¼ˆç™½ç—´ï¼‰è¢«æ”¾é€ï¼Œä½†ç¿»å¼€èº«ä»½ç‰Œç»§ç»­ç•™åœ¨æ¸¸æˆä¸­ï¼`, 'system');
                        }
                    }
                });
                
                // Simulate werewolf kill (for demo)
                const alivePlayers = gameState.players.filter(p => p.isAlive && p.role !== 'werewolf');
                if (alivePlayers.length > 0) {
                    const targetIndex = Math.floor(Math.random() * alivePlayers.length);
                    const targetPlayer = alivePlayers[targetIndex];
                    
                    // Check if witch saved this player
                    const witch = gameState.players.find(p => p.role === 'witch' && p.isAlive);
                    const wasSaved = witch && !witch.abilities.hasPotion;
                    
                    if (!wasSaved) {
                        targetPlayer.isAlive = false;
                        addChatMessage('ç³»ç»Ÿ', `${targetPlayer.name} è¢«ç‹¼äººæ€æ­»äº†ï¼`, 'system');
                        
                        // Check if player is a wolf
                        if (targetPlayer.role === 'werewolf') {
                            gameState.statistics.wolvesKilled++;
                        } else {
                            gameState.statistics.villagersKilled++;
                        }
                        
                        // Handle hunter ability
                        if (targetPlayer.role === 'hunter' && targetPlayer.abilities.hasShot) {
                            // In a real game, this would allow the hunter to choose a target
                            // For demo purposes, we'll randomly select a target
                            const alivePlayersAfterKill = gameState.players.filter(p => p.isAlive && p.id !== targetPlayer.id);
                            if (alivePlayersAfterKill.length > 0) {
                                const hunterTargetIndex = Math.floor(Math.random() * alivePlayersAfterKill.length);
                                const hunterTargetPlayer = alivePlayersAfterKill[hunterTargetIndex];
                                
                                hunterTargetPlayer.isAlive = false;
                                addChatMessage('ç³»ç»Ÿ', `${targetPlayer.name}ï¼ˆçŒäººï¼‰å¼€æªå¸¦èµ°äº† ${hunterTargetPlayer.name}ï¼`, 'system');
                                
                                // Check if target is a wolf
                                if (hunterTargetPlayer.role === 'werewolf') {
                                    gameState.statistics.wolvesKilled++;
                                } else {
                                    gameState.statistics.villagersKilled++;
                                }
                            }
                        }
                    } else {
                        addChatMessage('ç³»ç»Ÿ', `å¥³å·«ä½¿ç”¨äº†è§£è¯ï¼Œ${targetPlayer.name} è¢«æ•‘äº†ï¼`, 'system');
                    }
                }
            }

            // Reset votes for new voting phase
            function resetVotes() {
                gameState.players.forEach(player => {
                    player.hasVoted = false;
                    player.votesReceived = 0;
                });
                
                gameState.votes = {};
            }

            // Resolve voting
            function resolveVoting() {
                // Find player with most votes
                let maxVotes = 0;
                let playersWithMaxVotes = [];
                
                gameState.players.forEach(player => {
                    if (player.isAlive) {
                        if (player.votesReceived > maxVotes) {
                            maxVotes = player.votesReceived;
                            playersWithMaxVotes = [player];
                        } else if (player.votesReceived === maxVotes && maxVotes > 0) {
                            playersWithMaxVotes.push(player);
                        }
                    }
                });
                
                // Handle voting result
                if (playersWithMaxVotes.length === 1) {
                    const playerToLynch = playersWithMaxVotes[0];
                    playerToLynch.isAlive = false;
                    
                    addChatMessage('ç³»ç»Ÿ', `${playerToLynch.name} è¢«æ”¾é€äº†ï¼`, 'system');
                    
                    // Check if player is a wolf
                    if (playerToLynch.role === 'werewolf') {
                        gameState.statistics.wolvesKilled++;
                    } else {
                        gameState.statistics.villagersKilled++;
                    }
                    
                    // Handle hunter ability
                    if (playerToLynch.role === 'hunter' && playerToLynch.abilities.hasShot) {
                        // In a real game, this would allow the hunter to choose a target
                        // For demo purposes, we'll randomly select a target
                        const alivePlayers = gameState.players.filter(p => p.isAlive && p.id !== playerToLynch.id);
                        if (alivePlayers.length > 0) {
                            const targetIndex = Math.floor(Math.random() * alivePlayers.length);
                            const targetPlayer = alivePlayers[targetIndex];
                            
                            targetPlayer.isAlive = false;
                            addChatMessage('ç³»ç»Ÿ', `${playerToLynch.name}ï¼ˆçŒäººï¼‰å¼€æªå¸¦èµ°äº† ${targetPlayer.name}ï¼`, 'system');
                            
                            // Check if target is a wolf
                            if (targetPlayer.role === 'werewolf') {
                                gameState.statistics.wolvesKilled++;
                            } else {
                                gameState.statistics.villagersKilled++;
                            }
                        }
                    }
                    
                    // Handle idiot ability
                    if (playerToLynch.role === 'idiot') {
                        playerToLynch.isAlive = true; // Idiot doesn't die immediately
                        addChatMessage('ç³»ç»Ÿ', `${playerToLynch.name}ï¼ˆç™½ç—´ï¼‰è¢«æ”¾é€ï¼Œä½†ç¿»å¼€èº«ä»½ç‰Œç»§ç»­ç•™åœ¨æ¸¸æˆä¸­ï¼`, 'system');
                    }
                } else if (playersWithMaxVotes.length > 1) {
                    addChatMessage('ç³»ç»Ÿ', 'æŠ•ç¥¨ç»“æœå¹³å±€ï¼Œæ²¡æœ‰äººè¢«æ”¾é€ã€‚', 'system');
                } else {
                    addChatMessage('ç³»ç»Ÿ', 'æ²¡æœ‰äººè·å¾—æŠ•ç¥¨ï¼Œè·³è¿‡æ”¾é€ç¯èŠ‚ã€‚', 'system');
                }
            }

            // Check if game is over
            function checkGameOver() {
                const aliveWolves = gameState.players.filter(p => p.isAlive && p.role === 'werewolf').length;
                const aliveVillagers = gameState.players.filter(p => p.isAlive && p.role !== 'werewolf').length;
                
                // Check victory conditions
                if (aliveWolves === 0) {
                    // Villagers win
                    endGame('å¥½äººé˜µè¥èƒœåˆ©ï¼æ‰€æœ‰ç‹¼äººéƒ½è¢«æ”¾é€äº†ï¼');
                    return true;
                } else if (aliveWolves >= aliveVillagers) {
                    // Werewolves win
                    endGame('ç‹¼äººé˜µè¥èƒœåˆ©ï¼ç‹¼äººæ•°é‡å·²ç»è¶…è¿‡æˆ–ç­‰äºå¥½äººæ•°é‡ï¼');
                    return true;
                }
                
                return false;
            }

            // End the game
            function endGame(message) {
                // Stop the timer
                if (gameState.phaseTimer) {
                    clearInterval(gameState.phaseTimer);
                }
                
                gameState.gameStarted = false;
                gameOverMessage.textContent = message;
                
                // Update stats container
                statsContainer.innerHTML = `
                    <div class="space-y-4">
                        <p>æ¸¸æˆå¤©æ•°: ${gameState.statistics.totalDays}</p>
                        <p>æ€»æŠ•ç¥¨æ•°: ${gameState.statistics.votesCast}</p>
                        <p>æŠ€èƒ½ä½¿ç”¨æ¬¡æ•°: ${gameState.statistics.abilitiesUsed}</p>
                        <p>æ­»äº¡ç©å®¶æ•°: ${gameState.statistics.playersKilled}</p>
                        <p>è¢«æ”¾é€ç‹¼äºº: ${gameState.statistics.wolvesKilled}</p>
                        <p>è¢«æ”¾é€æ‘æ°‘: ${gameState.statistics.villagersKilled}</p>
                    </div>
                `;
                
                // Show game over modal
                gameOverModal.classList.remove('hidden');
            }

            // Show game statistics
            function showGameStatistics() {
                statisticsContent.innerHTML = '';
                
                // Add game summary
                const summarySection = document.createElement('div');
                summarySection.innerHTML = `
                    <h3 class="text-2xl font-bold text-[var(--text-gold)] mb-4">æ¸¸æˆæ€»ç»“</h3>
                    <div class="space-y-2">
                        <p>æ¸¸æˆå¤©æ•°: ${gameState.statistics.totalDays}</p>
                        <p>æ€»æŠ•ç¥¨æ•°: ${gameState.statistics.votesCast}</p>
                        <p>æŠ€èƒ½ä½¿ç”¨æ¬¡æ•°: ${gameState.statistics.abilitiesUsed}</p>
                        <p>æ­»äº¡ç©å®¶æ•°: ${gameState.statistics.playersKilled}</p>
                        <p>è¢«æ”¾é€ç‹¼äºº: ${gameState.statistics.wolvesKilled}</p>
                        <p>è¢«æ”¾é€æ‘æ°‘: ${gameState.statistics.villagersKilled}</p>
                    </div>
                `;
                statisticsContent.appendChild(summarySection);
                
                // Add player statistics
                const playersSection = document.createElement('div');
                playersSection.innerHTML = `<h3 class="text-2xl font-bold text-[var(--text-gold)] mb-4">ç©å®¶è¡¨ç°</h3>`;
                
                const playersList = document.createElement('div');
                playersList.className = 'space-y-4';
                
                gameState.players.forEach(player => {
                    const playerStats = document.createElement('div');
                    playerStats.className = 'p-4 rounded-lg bg-[var(--primary-dark)]';
                    
                    const roleInfo = `${roles[player.role].icon} ${roles[player.role].name}`;
                    const statusInfo = player.isAlive ? 'å­˜æ´»' : 'æ­»äº¡';
                    
                    playerStats.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span class="${roles[player.role].color} font-bold">${player.name} (${roleInfo})</span>
                            <span>${statusInfo}</span>
                        </div>
                    `;
                    
                    playersList.appendChild(playerStats);
                });
                
                playersSection.appendChild(playersList);
                statisticsContent.appendChild(playersSection);
            }

            // Open voting panel
            function openVotingPanel() {
                votingOptions.innerHTML = '';
                
                // Filter out dead players and current player
                const eligiblePlayers = gameState.players.filter(p => p.isAlive);
                
                eligiblePlayers.forEach(player => {
                    const voteOption = document.createElement('div');
                    voteOption.className = 'player-avatar flex flex-col items-center cursor-pointer';
                    voteOption.dataset.playerId = player.id;
                    
                    const avatarFrame = document.createElement('div');
                    avatarFrame.className = 'avatar-frame w-16 h-16 flex items-center justify-center text-3xl mb-2';
                    
                    // Show role icon if player is dead or in developer mode
                    const showRole = gameState.developerMode;
                    avatarFrame.innerHTML = showRole ? roles[player.role].icon : 'â“';
                    
                    const playerName = document.createElement('div');
                    playerName.className = 'text-center';
                    playerName.textContent = player.name;
                    
                    voteOption.appendChild(avatarFrame);
                    voteOption.appendChild(playerName);
                    
                    // Add click event to select player
                    voteOption.addEventListener('click', () => {
                        // Remove selected class from all options
                        votingOptions.querySelectorAll('.selected').forEach(el => {
                            el.classList.remove('selected');
                        });
                        
                        // Add selected class to clicked option
                        voteOption.classList.add('selected');
                        
                        // Enable submit button
                        submitVoteBtn.disabled = false;
                    });
                    
                    votingOptions.appendChild(voteOption);
                });
                
                // Update voting info
                totalPlayers.textContent = gameState.players.filter(p => p.isAlive).length;
                currentVotes.textContent = Object.keys(gameState.votes).length;
                
                // Reset voting timer
                let votingTimeLeft = 30;
                votingTimer.textContent = votingTimeLeft;
                
                const votingTimerInterval = setInterval(() => {
                    votingTimeLeft--;
                    votingTimer.textContent = votingTimeLeft;
                    
                    if (votingTimeLeft <= 0) {
                        clearInterval(votingTimerInterval);
                        
                        // If no vote selected, randomly select one
                        if (!votingOptions.querySelector('.selected') && eligiblePlayers.length > 0) {
                            const randomIndex = Math.floor(Math.random() * eligiblePlayers.length);
                            votingOptions.children[randomIndex].click();
                        }
                        
                        // Submit vote if an option is selected
                        if (!submitVoteBtn.disabled) {
                            submitVote();
                        } else {
                            // Close modal if no vote selected
                            votingModal.classList.add('hidden');
                        }
                    }
                }, 1000);
                
                // Show voting modal
                votingModal.classList.remove('hidden');
                
                // Reset submit button
                submitVoteBtn.disabled = true;
                
                // Store timer interval to clear later
                votingModal.dataset.timerInterval = votingTimerInterval;
            }

            // Submit vote
            function submitVote() {
                const selectedOption = votingOptions.querySelector('.selected');
                
                if (selectedOption) {
                    const targetPlayerId = parseInt(selectedOption.dataset.playerId);
                    const currentPlayer = gameState.players[gameState.currentPlayerIndex];
                    
                    // Record vote
                    gameState.votes[currentPlayer.id] = targetPlayerId;
                    gameState.players[targetPlayerId].votesReceived++;
                    currentPlayer.hasVoted = true;
                    
                    gameState.statistics.votesCast++;
                    
                    // Update current votes count
                    currentVotes.textContent = Object.keys(gameState.votes).length;
                    
                    // Add chat message
                    addChatMessage(currentPlayer.name, `æŠ•ç¥¨ç»™äº† ${gameState.players[targetPlayerId].name}`, 'private');
                    
                    // Clear voting timer
                    clearInterval(parseInt(votingModal.dataset.timerInterval));
                    
                    // Close voting modal
                    votingModal.classList.add('hidden');
                    
                    // Update player avatars to show votes
                    updatePlayerAvatars();
                    
                    // Check if all players have voted
                    const alivePlayers = gameState.players.filter(p => p.isAlive);
                    const votedPlayers = gameState.players.filter(p => p.hasVoted);
                    
                    if (alivePlayers.length === votedPlayers.length) {
                        // All players have voted, proceed to next phase
                        setTimeout(() => {
                            proceedToNextPhase();
                        }, 2000);
                    }
                }
            }

            // Send chat message
            function sendChatMessage(content) {
                const currentPlayer = gameState.players[gameState.currentPlayerIndex];
                addChatMessage(currentPlayer.name, content, 'normal');
            }

            // Add chat message to chat area
            function addChatMessage(sender, content, type = 'normal') {
                const messageElement = document.createElement('div');
                messageElement.className = `chat-message ${type}`;
                
                if (type === 'private') {
                    messageElement.innerHTML = `<span class="font-bold">${sender}ï¼ˆç§èŠï¼‰:</span> ${content}`;
                } else {
                    const currentPlayer = gameState.players[gameState.currentPlayerIndex];
                    const senderObj = gameState.players.find(p => p.name === sender);
                    const senderColor = senderObj ? senderObj.chatColor : '';
                    
                    messageElement.innerHTML = `<span class="font-bold ${sender === 'ç³»ç»Ÿ' ? 'text-[var(--text-gold)]' : senderColor}">${sender}:</span> ${content}`;
                }
                
                chatArea.appendChild(messageElement);
                
                // Scroll to bottom
                chatArea.scrollTop = chatArea.scrollHeight;
            }

            // Start game loop
            function startGameLoop() {
                // In a real game, this would handle the game flow
                // For demo purposes, we'll just update the UI
                updateGameUI();
            }

            // Reset game
            function resetGame() {
                // Stop the timer
                if (gameState.phaseTimer) {
                    clearInterval(gameState.phaseTimer);
                }
                
                // Hide game screens and show menu
                gameScreen.classList.add('hidden');
                gameOverModal.classList.add('hidden');
                gameStatisticsModal.classList.add('hidden');
                
                menuScreen.classList.remove('hidden');
                
                // Reset game state
                gameState.playerCount = null;
                gameState.players = [];
                gameState.currentPlayerIndex = 0;
                gameState.day = 1;
                gameState.isDay = false;
                gameState.phase = 'night';
                gameState.votes = {};
                gameState.gameStarted = false;
                
                // Reset UI
                playerCountOptions.querySelectorAll('button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                startGameBtn.disabled = true;
                
                // Clear chat area
                chatArea.innerHTML = '';
            }

            // Utility function to shuffle array
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            // Initialize the game
            init();
        });
    </script>
</body>
</html>